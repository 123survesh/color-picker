<!DOCTYPE html>
<html dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Color Picker</title>
  </head>
  <body>

<input type="text">

<style>
* {
  margin:0;
  padding:0;
}
body {padding:50px}
input[type=text] {
  font:normal bold 13px/30px Helmet,FreeSans,Sans-Serif;
  background-color:white;
  border:0;
  color:black;
  width:6em;
  height:30px;
  padding:0 8px;
  text-align:left;
  text-transform:uppercase;
}




.color-picker {
  position:absolute;
  top:0;
  left:0;
  z-index:9999;
}
.color-picker-control {
  width:170px;
  height:150px;
  border:1px solid #000;
  box-shadow:1px 5px 10px rgba(0,0,0,.5);
}
.color-picker-control:after {
  content:" ";
  display:table;
  clear:both;
}
.color-picker i {font:inherit}
.color-picker-h {
  position:relative;
  width:19px;
  height:150px;
  float:right;
  border-left:1px solid;
  border-color:inherit;
  cursor:ns-resize;
  background:transparent url('color-picker-h.png') no-repeat 50% 50%;
  background-image:linear-gradient(to bottom,#f00 0%,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,#f00 100%);
  background-size:100% 100%;
  overflow:hidden;
}
.color-picker-h i {
  position:absolute;
  top:-3px;
  right:0;
  left:0;
  z-index:3;
  display:block;
  height:6px;
}
.color-picker-h i:before {
  content:"";
  position:absolute;
  top:0;
  right:0;
  bottom:0;
  left:0;
  display:block;
  border:3px solid;
  border-color:inherit;
  border-top-color:transparent;
  border-bottom-color:transparent;
}
.color-picker-h i:after {
  top:-1px;
  right:-1px;
  bottom:-1px;
  left:-1px;
  border-color:#000;
}
.color-picker-sv {
  position:relative;
  width:150px;
  height:150px;
  float:left;
  background:transparent url('color-picker-sv.png') no-repeat 50% 50%;
  background-image:linear-gradient(to top,#000,rgba(0,0,0,0)),linear-gradient(to right,#fff,rgba(255,255,255,0));
  background-size:100% 100%;
  cursor:crosshair;
}
.color-picker-sv i {
  position:absolute;
  top:-4px;
  right:-4px;
  z-index:3;
  display:block;
  width:8px;
  height:8px;
}
.color-picker-sv i:before,
.color-picker-sv i:after {
  content:"";
  position:absolute;
  top:-1px;
  right:-1px;
  bottom:-1px;
  left:-1px;
  display:block;
  border:1px solid #fff;
  border-radius:100%;
}
.color-picker-sv i:after {
  top:0;
  right:0;
  bottom:0;
  left:0;
  border-color:#000;
}
</style>

<script>


/*!
 * ==========================================================
 *  COLOR PICKER PLUGIN 1.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 * ----------------------------------------------------------
 */

var CP = function(target) {

    var w = window,
        d = document,
        r = this,
        noop = function() {},
        hooks = {},
        picker = d.createElement('div');

    function isset(x) {
        return typeof x !== "undefined";
    }

    // [h, s, v] ... 0 <= h, s, v <= 1
    function HSV2RGB(a) {
        var h = +a[0],
            s = +a[1],
            v = +a[2],
            r, g, b, i, f, p, q, t;
        i = Math.floor(h * 6);
        f = h * 6 - i;
        p = v * (1 - s);
        q = v * (1 - f * s);
        t = v * (1 - (1 - f) * s);
        if (isNaN(i)) i = 0;
        if (isNaN(q)) q = 0;
        if (isNaN(t)) t = 0;
        switch (i % 6) {
            case 0:
                r = v, g = t, b = p;
                break;
            case 1:
                r = q, g = v, b = p;
                break;
            case 2:
                r = p, g = v, b = t;
                break;
            case 3:
                r = p, g = q, b = v;
                break;
            case 4:
                r = t, g = p, b = v;
                break;
            case 5:
                r = v, g = p, b = q;
                break;
        }
        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
    }
    function HSV2HEX(a) {
        return RGB2HEX(HSV2RGB(a));
    }

    // [r, g, b] ... 0 <= r, g, b <= 255
    function RGB2HSV(a) {
        var r = +a[0],
            g = +a[1],
            b = +a[2],
            max = Math.max(r, g, b),
            min = Math.min(r, g, b),
            d = max - min,
            h, s = (max === 0 ? 0 : d / max),
            v = max / 255;
        switch (max) {
            case min:
                h = 0;
                break;
            case r:
                h = (g - b) + d * (g < b ? 6 : 0);
                h /= 6 * d;
                break;
            case g:
                h = (b - r) + d * 2;
                h /= 6 * d;
                break;
            case b:
                h = (r - g) + d * 4;
                h /= 6 * d;
                break;
        }
        return [h, s, v];
    }
    function RGB2HEX(a) {
        var s = +a[2] | (+a[1] << 8) | (+a[0] << 16);
        s = '000000' + s.toString(16);
        return '#' + s.slice(-6);
    }

    // #rrggbb or #rgb
    function HEX2HSV(s) {
        return RGB2HSV(HEX2RGB(s));
    }
    function HEX2RGB(s) {
        s = s.replace('#', "");
        if (s.length === 3) {
            s = s.replace(/./g, '$&$&');
        }
        return [parseInt(s[0] + s[1], 16), parseInt(s[2] + s[3], 16), parseInt(s[4] + s[5], 16)];
    }

    // convert range from `0` to `360` and `0` to `100` in color into range from `0` to `1`
    function _2HSV_private(a) {
        return [1 * (+a[0] / 360), 1 - (+a[1] / 100), 1 - (+a[2] / 100)];
    }

    // convert range from `0` to `1` in color into `0` to `360` and `0` to `100`
    function _2HSV_public(a) {
        return [+a[0] * 360, +a[1] * 100, +a[2] * 100];
    }

    // *
    function _2HSV(x) {
        var rgb = /\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i.exec(x),
            hsv = /\s*hsv\s*\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)\s*$/i.exec(x),
            hex = x[0] === '#' || x.match(/^#?([\da-f]{3}|[\da-f]{6})$/);
        if (hex) {
            return HEX2HSV(x);
        } else if (hsv) {
            return _2HSV_private([+hsv[1], +hsv[2], +hsv[3]]);
        } else if (rgb) {
            return RGB2HSV([+rgb[1], +rgb[2], +rgb[3]]);
        }
        return [0, 1, 1];
    }

    // add event
    function on(ev, el, fn) {
        return el.addEventListener(ev, fn, false);
    }

    // remove event
    function off(ev, el, fn) {
        return el.removeEventListener(ev, fn);
    }

    // get mouse/finger coordinate
    function point(el, e) {
      var x = !!e.touches ? e.touches[0].pageX : e.pageX,
          y = !!e.touches ? e.touches[0].pageY : e.pageY,
          left = el.offsetLeft,
          top = el.offsetTop;
      while (el = el.offsetParent) {
          left += el.offsetLeft;
          top += el.offsetTop;
          el = el.offsetParent;
      }
      return {
          x: x - left,
          y: y - top
      };
    }

    // get position
    function offset(el) {
        return {
            l: el.offsetLeft,
            t: el.offsetTop
        };
    }

    // get dimension
    function size(el) {
        return {
            w: el.offsetWidth,
            h: el.offsetHeight
        };
    }

    // get color data
    function get_data(el, a) {
        var s = el.getAttribute('data-color');
        s = s ? s.split(',') : [];
        if (!isset(a)) a = false;
        return s.length ? [+s[0], +s[1], +s[2]] : a;
    }

    // set color data
    function set_data(el, a) {
        return el.setAttribute('data-color', a.join(','));
    }

    // add hook
    function add(ev, fn, id) {
        if (!isset(hooks[ev])) hooks[ev] = {};
        if (!isset(ev)) return hooks;
        if (!isset(fn)) return hooks[ev];
        if (!isset(id)) return hooks[ev][Object.keys(hooks[ev]).length] = fn;
        hooks[ev][id] = fn;
    }

    // remove hook
    function remove(ev, id) {
        if (!isset(ev)) return hooks = {};
        if (!isset(id)) return hooks[ev] = {};
        delete hooks[ev][id];
    }

    // trigger hook
    function trigger(ev, v, id) {
        if (!isset(hooks[ev])) return;
        if (!isset(id)) {
            for (var i in hooks[ev]) {
                hooks[ev][i](v);
            }
        } else {
            if (isset(hooks[ev][id])) {
                hooks[ev][id](v);
            }
        }
    }

    // initialize data ...
    var data = get_data(target);
    if (target.value && target.value.length) {
        set_data(target, _2HSV(target.value));
    } else if (data && !target.value) {
        set_data(target, _2HSV(data));
    }

    // generate color picker pane ...
    picker.className = 'color-picker';
    picker.innerHTML = '<div class="color-picker-control"><span class="color-picker-h"><i></i></span><span class="color-picker-sv"><i></i></span></div>';
    var c = picker.firstChild.children,
        HSV = get_data(target, [0, 1, 1]), // default is red
        H = c[0],
        SV = c[1],
        H_point = H.firstChild,
        SV_point = SV.firstChild,
        drag_H = false,
        drag_SV = false,
        left = 0,
        top = 0,
        P_W = 0,
        P_H = 0;

    // fit to window
    function fit() {
        v = HSV2HEX(HSV);
        left = offset(target).l;
        top = offset(target).t + size(target).h;
        if (left + P_W > w.innerWidth) {
            left = w.innerWidth - P_W;
        }
        if (top + P_H > w.innerHeight) {
            top = w.innerHeight - P_H;
        }
        picker.style.left = left + 'px';
        picker.style.top = top + 'px';
        trigger("fit", v);
    };

    // create
    function create(first) {
        if (!first) d.body.appendChild(picker);
        P_W = size(picker).w;
        P_H = size(picker).h;
        var H_H = size(H).h,
            SV_W = size(SV).w,
            SV_H = size(SV).h,
            H_point_H = size(H_point).h,
            SV_point_W = size(SV_point).w,
            SV_point_H = size(SV_point).h, v;
        if (first) {
            picker.style.left = '-9999px';
            picker.style.top = '-9999px';
            on("resize", w, fit);
        } else {
            fit();
            trigger("enter");
        }
        H_point.style.top = ((H_H * +HSV[0]) - (H_point_H / 2)) + 'px';
        SV_point.style.right = (SV_W - (SV_point_W / 2) - (SV_W * +HSV[1])) + 'px';
        SV_point.style.top = (SV_H - (SV_point_H / 2) - (SV_H * +HSV[2])) + 'px';
        function color(e) {
            var a = HSV2RGB(HSV),
                b = HSV2RGB([HSV[0], 1, 1]);
            SV.style.backgroundColor = 'rgb(' + b.join(',') + ')';
            set_data(target, HSV);
            if (e) e.preventDefault();
        } color();
        function do_H(e) {
            var o = point(H, e), y = o.y;
            if (y < 0) {
                y = 0;
            } else if (y > H_H) {
                y = H_H;
            }
            HSV[0] = 1 - ((H_H - y) / H_H);
            H_point.style.top = (y - (H_point_H / 2)) + 'px';
            color(e);
        }
        function do_SV(e) {
            var o = point(SV, e),
                x = o.x,
                y = o.y;
            if (x < 0) {
                x = 0;
            } else if (x > SV_W) {
                x = SV_W;
            }
            if (y < 0) {
                y = 0;
            } else if (y > SV_H) {
                y = SV_H;
            }
            HSV[1] = 1 - ((SV_W - x) / SV_W);
            HSV[2] = (SV_H - y) / SV_H;
            SV_point.style.right = (SV_W - x - (SV_point_W / 2)) + 'px';
            SV_point.style.top = (y - (SV_point_H / 2)) + 'px';
            color(e);
        }
        function move(e) {
            if (drag_H) {
                do_H(e);
                v = HSV2HEX(HSV);
                trigger("drag:h", v);
                trigger("drag", v);
            }
            if (drag_SV) {
                do_SV(e);
                v = HSV2HEX(HSV);
                trigger("drag:sv", v);
                trigger("drag", v);
            }
        }
        function stop() {
            drag_H = false;
            drag_SV = false;
            if (!first) trigger("stop", HSV2HEX(HSV));
        }
        function exit() {
            if (picker.parentNode) d.body.removeChild(picker);
            off("touchmove", d, move);
            off("mousemove", d, move);
            off("touchend", d, stop);
            off("mouseup", d, stop);
            off("touchdown", d, exit);
            off("click", d, exit);
            trigger("exit");
        }
        function down_H(e) {
            drag_H = true;
            do_H(e);
            trigger("start:h");
            trigger("start");
        }
        function down_SV(e) {
            drag_SV = true;
            do_SV(e);
            trigger("start:sv");
            trigger("start");
        }
        on("touchstart", H, down_H);
        on("mousedown", H, down_H);
        on("touchstart", SV, down_SV);
        on("mousedown", SV, down_SV);
        on("touchmove", d, move);
        on("mousemove", d, move);
        on("touchend", d, stop);
        on("mouseup", d, stop);
        on("touchdown", d, exit);
        on("click", d, exit);
    } create(1);

    w.setTimeout(function() {
        trigger("create", HSV2HEX(HSV));
    }, .1);

    // click to show
    function click(e) {
        create();
        e.stopPropagation();
    }

    on("click", target, click);

    // register to global ...
    r.target = target;
    r.picker = picker;
    r.on = add;
    r.off = remove;
    r.trigger = trigger;
    r.fit = fit;
    r.HSV2RGB = function(a) {
        return HSV2RGB(_2HSV_private(a));
    };
    r.HSV2HEX = function(a) {
        return HSV2HEX(_2HSV_private(a));
    };
    r.RGB2HSV = function(a) {
        return _2HSV_public(RGB2HSV(a));
    };
    r.RGB2HEX = RGB2HEX;
    r.HEX2HSV = function(s) {
        return _2HSV_public(HEX2HSV(a));
    };
    r.HEX2RGB = HEX2RGB;
    r._2HSV = _2HSV;
    r.hooks = hooks;
    r.data = function(a) {
        if (!isset(a)) return get_data(target);
        set_data(target, a);
    };
    r.destroy = function() {
        trigger("destroy");
        off("click", click);
        exit();
    };

    // return the global data
    return r;

};


var picker = new CP(document.querySelector('input'));

function on_start() {
    console.log('start');
}

function on_drag(v) {
    picker.target.value = v;
    document.body.style.backgroundColor = v;
    console.log('drag');
}

function on_stop() {
    console.log('stop');
}

function on_enter() {
    console.log('enter');
}

function on_exit() {
    console.log('exit');
}

function on_fit() {
    console.log('fit');
}

function on_create(v) {
    console.log('create');
    on_drag(v);
}

function on_destroy() {
    console.log('destroy');
}

picker.on("start", on_start);
picker.on("drag", on_drag);
picker.on("stop", on_stop);
picker.on("enter", on_enter);
picker.on("exit", on_exit);
picker.on("fit", on_fit);
picker.on("create", on_create);
picker.on("destroy", on_destroy);
</script>

  </body>
</html>